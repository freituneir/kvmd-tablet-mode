<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
	<title>PiKVM Tablet</title>

	<link rel="stylesheet" href="css/variables.css">
	<link rel="stylesheet" href="css/layout.css">
	<link rel="stylesheet" href="css/stream.css">
	<link rel="stylesheet" href="css/overlays.css">
	<link rel="stylesheet" href="css/keyboard.css">
	<link rel="stylesheet" href="css/drawer.css">
	<link rel="stylesheet" href="css/components.css">

	<script type="module" src="js/main.js"></script>
</head>
<body>
	<!-- Login Screen -->
	<div id="login-screen" class="login-screen">
		<div class="login-card">
			<h1 class="login-title">PiKVM</h1>
			<p class="login-subtitle">Tablet Interface</p>
			<form id="login-form" autocomplete="on">
				<div class="form-group">
					<input type="text" id="login-user" placeholder="Username" autocomplete="username" required>
				</div>
				<div class="form-group">
					<input type="password" id="login-password" placeholder="Password" autocomplete="current-password" required>
				</div>
				<button type="submit" id="login-button" class="btn btn-primary">Sign In</button>
				<div id="login-error" class="login-error hidden"></div>
			</form>
		</div>
	</div>

	<!-- Main App (hidden until authenticated) -->
	<div id="app" class="app hidden">

		<!-- Layer 1: Stream -->
		<div id="stream-container" class="stream-container">
			<video id="stream-video" class="stream-element hidden" autoplay playsinline muted></video>
			<img id="stream-image" class="stream-element hidden" alt="Stream">
		</div>

		<!-- Layer 2: Persistent Overlays -->
		<div id="top-bar" class="top-bar">
			<div class="top-bar-left">
				<span id="connection-led" class="led led-gray" title="Disconnected"></span>
				<span id="stream-mode-badge" class="badge">--</span>
				<span id="stream-info-text" class="info-text"></span>
			</div>
			<div class="top-bar-right">
				<button id="keyboard-capture-btn" class="top-btn hidden" title="Keyboard capture off">
					<span class="capture-indicator">KB</span>
				</button>
				<button id="scroll-widget-toggle-btn" class="top-btn" title="Toggle scroll widget">
					<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M7 10l5-5 5 5z"/><path d="M7 14l5 5 5-5z"/></svg>
				</button>
				<button id="zoom-toggle-btn" class="top-btn" title="Toggle 1:1 zoom">
					<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"/></svg>
				</button>
				<button id="keyboard-toggle-btn" class="top-btn" title="Toggle keyboard">
					<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"/></svg>
				</button>
				<button id="fullscreen-btn" class="top-btn" title="Fullscreen">
					<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
				</button>
				<button id="menu-btn" class="top-btn" title="Menu">
					<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
				</button>
			</div>
		</div>

		<!-- Floating Mouse Panel -->
		<div id="mouse-panel" class="mouse-panel">
			<button id="mouse-panel-collapse-btn" class="mouse-panel-toggle" title="Collapse panel">
				<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
			</button>
			<div id="mouse-panel-buttons">
				<button id="mouse-btn-left" class="mouse-btn" data-button="left" title="Left click">L</button>
				<button id="mouse-btn-middle" class="mouse-btn" data-button="middle" title="Middle click">M</button>
				<button id="mouse-btn-right" class="mouse-btn" data-button="right" title="Right click">R</button>
				<button id="mouse-panel-keyboard-btn" class="mouse-btn mouse-btn-icon" title="Quick type">
					<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"/></svg>
				</button>
				<button id="mouse-panel-paste-btn" class="mouse-btn mouse-btn-icon" title="Paste clipboard">
					<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg>
				</button>
			</div>
		</div>

		<!-- Virtual Scroll Widget (Jog Shuttle) -->
		<div id="scroll-widget" class="scroll-widget">
			<div class="scroll-widget-track" id="scroll-widget-track"></div>
			<div class="scroll-widget-thumb" id="scroll-widget-thumb"></div>
		</div>

		<!-- Layer 3: On-Demand Panels -->

		<!-- Keyboard Panel -->
		<div id="keyboard-panel" class="keyboard-panel hidden">
			<div class="keyboard-header">
				<button id="keyboard-close-btn" class="keyboard-close-btn" title="Close keyboard">&times;</button>
			</div>
			<div class="keyboard-rows">
				<div class="keyboard-row" id="keyboard-row-function">
					<button class="key key-sm" data-key="Escape">Esc</button>
					<button class="key key-sm" data-key="F1">F1</button>
					<button class="key key-sm" data-key="F2">F2</button>
					<button class="key key-sm" data-key="F3">F3</button>
					<button class="key key-sm" data-key="F4">F4</button>
					<button class="key key-sm" data-key="F5">F5</button>
					<button class="key key-sm" data-key="F6">F6</button>
					<button class="key key-sm" data-key="F7">F7</button>
					<button class="key key-sm" data-key="F8">F8</button>
					<button class="key key-sm" data-key="F9">F9</button>
					<button class="key key-sm" data-key="F10">F10</button>
					<button class="key key-sm" data-key="F11">F11</button>
					<button class="key key-sm" data-key="F12">F12</button>
					<button class="key key-sm" data-key="PrintScreen">PrtSc</button>
					<button class="key key-sm" data-key="Pause">Pause</button>
					<button class="key key-sm" data-key="Delete">Del</button>
					<button class="key key-sm" data-key="Insert">Ins</button>
				</div>
				<div class="keyboard-row" id="keyboard-row-modifiers">
					<button class="key key-mod" data-key="ControlLeft" data-toggle="true">Ctrl</button>
					<button class="key key-mod" data-key="AltLeft" data-toggle="true">Alt</button>
					<button class="key key-mod" data-key="MetaLeft" data-toggle="true">Super</button>
					<button class="key key-mod" data-key="ShiftLeft" data-toggle="true">Shift</button>
					<button class="key key-mod" data-key="Tab">Tab</button>
					<button class="key key-mod" data-key="CapsLock" data-toggle="true">Caps</button>
				</div>
				<div class="keyboard-row" id="keyboard-row-combos">
					<button class="key key-combo" data-combo="ControlLeft,AltLeft,Delete">Ctrl+Alt+Del</button>
					<button class="key key-combo" data-combo="AltLeft,Tab">Alt+Tab</button>
					<button class="key key-combo" data-combo="AltLeft,F4">Alt+F4</button>
					<button class="key key-combo" data-combo="MetaLeft,KeyD">Win+D</button>
					<button class="key key-combo" data-combo="MetaLeft,KeyL">Win+L</button>
					<button class="key key-combo" data-combo="MetaLeft,KeyR">Win+R</button>
					<button class="key key-combo" data-combo="ControlLeft,AltLeft,Backspace">Ctrl+Alt+BS</button>
				</div>
				<div class="keyboard-row" id="keyboard-row-arrows">
					<button class="key key-sm" data-key="Home">Home</button>
					<button class="key key-sm" data-key="End">End</button>
					<button class="key key-sm" data-key="PageUp">PgUp</button>
					<button class="key key-sm" data-key="PageDown">PgDn</button>
					<span class="keyboard-spacer"></span>
					<button class="key key-arrow" data-key="ArrowUp">&uarr;</button>
					<span class="keyboard-spacer"></span>
					<button class="key key-sm" data-key="Enter">Enter</button>
					<button class="key key-sm" data-key="Backspace">BkSp</button>
					<button class="key key-sm" data-key="Space">Space</button>
				</div>
				<div class="keyboard-row" id="keyboard-row-arrows-2">
					<button id="text-input-btn" class="key key-wide key-accent">Type Text...</button>
					<span class="keyboard-spacer-grow"></span>
					<button class="key key-arrow" data-key="ArrowLeft">&larr;</button>
					<button class="key key-arrow" data-key="ArrowDown">&darr;</button>
					<button class="key key-arrow" data-key="ArrowRight">&rarr;</button>
				</div>
			</div>
		</div>

		<!-- Admin Drawer -->
		<div id="drawer-overlay" class="drawer-overlay hidden"></div>
		<div id="admin-drawer" class="admin-drawer hidden">
			<div class="drawer-header">
				<h2>PiKVM</h2>
				<button id="drawer-close-btn" class="drawer-close-btn">&times;</button>
			</div>
			<div class="drawer-tabs">
				<button class="drawer-tab active" data-tab="atx">ATX</button>
				<button class="drawer-tab" data-tab="msd">MSD</button>
				<button class="drawer-tab" data-tab="gpio">GPIO</button>
				<button class="drawer-tab" data-tab="info">Info</button>
				<button class="drawer-tab" data-tab="settings">Settings</button>
			</div>
			<div class="paste-box">
				<input type="text" id="paste-input" class="paste-input" placeholder="Paste text here...">
				<button id="paste-send-btn" class="btn btn-primary paste-send-btn">Send</button>
			</div>
			<div class="drawer-content">
				<!-- ATX Panel -->
				<div id="tab-atx" class="tab-panel active">
					<div class="panel-section">
						<div class="status-row">
							<span>Power State</span>
							<span id="atx-power-led" class="led led-gray"></span>
							<span id="atx-power-text">Unknown</span>
						</div>
						<div class="btn-grid">
							<button class="btn btn-success" id="atx-power-on-btn">Power On</button>
							<button class="btn btn-warning" id="atx-power-off-btn">Power Off</button>
							<button class="btn btn-danger" id="atx-force-off-btn">Force Off</button>
							<button class="btn btn-warning" id="atx-reset-btn">Reset</button>
							<button class="btn btn-danger" id="atx-force-reset-btn">Force Reset</button>
						</div>
					</div>
				</div>

				<!-- MSD Panel -->
				<div id="tab-msd" class="tab-panel hidden">
					<div class="panel-section">
						<div class="status-row">
							<span>Drive State</span>
							<span id="msd-status-text">Disconnected</span>
						</div>
						<div class="status-row">
							<span>Current Image</span>
							<span id="msd-image-name">None</span>
						</div>
						<div class="msd-controls">
							<div class="msd-mode-toggle">
								<label><input type="radio" name="msd-mode" value="cdrom" checked> CD/DVD</label>
								<label><input type="radio" name="msd-mode" value="flash"> Flash</label>
							</div>
							<select id="msd-image-select" class="form-select">
								<option value="">-- Select image --</option>
							</select>
							<div class="btn-row">
								<button class="btn btn-success" id="msd-connect-btn">Connect</button>
								<button class="btn btn-warning" id="msd-disconnect-btn">Disconnect</button>
							</div>
						</div>
						<div class="msd-upload">
							<label class="btn btn-secondary btn-file">
								Upload Image
								<input type="file" id="msd-upload-input" accept=".iso,.img" hidden>
							</label>
							<div id="msd-upload-progress" class="progress-bar hidden">
								<div class="progress-fill"></div>
								<span class="progress-text">0%</span>
							</div>
						</div>
					</div>
				</div>

				<!-- GPIO Panel -->
				<div id="tab-gpio" class="tab-panel hidden">
					<div class="panel-section">
						<div id="gpio-channels">
							<p class="text-muted">No GPIO channels configured.</p>
						</div>
					</div>
				</div>

				<!-- Info Panel -->
				<div id="tab-info" class="tab-panel hidden">
					<div class="panel-section">
						<div class="info-grid" id="info-grid">
							<div class="info-row"><span>Platform</span><span id="info-platform">--</span></div>
							<div class="info-row"><span>Hostname</span><span id="info-hostname">--</span></div>
							<div class="info-row"><span>KVMD Version</span><span id="info-kvmd-version">--</span></div>
							<div class="info-row"><span>Streamer</span><span id="info-streamer">--</span></div>
						</div>
						<div class="btn-row" style="margin-top: 16px;">
							<a class="btn btn-secondary" id="info-desktop-link" href="/" target="_blank">Open Desktop UI</a>
						</div>
					</div>
				</div>

				<!-- Settings Panel -->
				<div id="tab-settings" class="tab-panel hidden">
					<div class="panel-section">
						<div class="setting-row">
							<span>Stream Mode</span>
							<select id="setting-stream-mode" class="form-select">
								<option value="auto">Auto (WebRTC &rarr; MJPEG)</option>
								<option value="janus">WebRTC (H.264)</option>
								<option value="mjpeg">MJPEG</option>
							</select>
						</div>
						<div class="setting-row">
							<span>Mouse Mode</span>
							<select id="setting-mouse-mode" class="form-select">
								<option value="absolute">Absolute (touch to point)</option>
								<option value="relative">Relative (trackpad)</option>
							</select>
						</div>
						<div class="setting-row">
							<span>Theme</span>
							<select id="setting-theme" class="form-select">
								<option value="dark">Dark</option>
								<option value="light">Light</option>
								<option value="auto">Auto (system)</option>
							</select>
						</div>
						<div class="setting-row" id="setting-jiggler-row">
							<span>Mouse Jiggler</span>
							<button id="setting-jiggler-toggle" class="toggle-switch" role="switch" aria-checked="false" disabled title="Prevents remote screen from sleeping"></button>
						</div>
						<div class="setting-row">
							<span>Relative Mouse Sensitivity</span>
							<div class="setting-range-row">
								<input type="range" id="setting-mouse-sensitivity" class="form-range" min="0.5" max="3" step="0.25" value="1">
								<span id="setting-mouse-sensitivity-value" class="setting-value">1x</span>
							</div>
						</div>
						<div class="setting-row">
							<span>Scroll Sensitivity</span>
							<div class="setting-range-row">
								<input type="range" id="setting-scroll-sensitivity" class="form-range" min="0.5" max="10" step="0.5" value="2">
								<span id="setting-scroll-sensitivity-value" class="setting-value">2</span>
							</div>
						</div>
						<div class="setting-row">
							<span>Scroll Widget Preset</span>
							<select id="setting-scroll-preset" class="form-select">
								<option value="fine">Fine (BIOS / Menus)</option>
								<option value="normal">Normal</option>
								<option value="fast">Fast (Documents)</option>
							</select>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Text input area for "Type Text" feature with close button -->
		<div id="text-input-wrap" class="text-input-wrap hidden">
			<textarea id="text-input-area" class="text-input-area" placeholder="Start typing â€” sent live to remote machine..." rows="1"></textarea>
			<button id="text-input-close-btn" class="text-input-close-btn" title="Close">&times;</button>
		</div>

		<!-- Confirm dialog -->
		<div id="confirm-dialog" class="confirm-dialog hidden">
			<div class="confirm-card">
				<p id="confirm-text"></p>
				<div class="btn-row">
					<button id="confirm-yes" class="btn btn-danger">Confirm</button>
					<button id="confirm-no" class="btn btn-secondary">Cancel</button>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
